<ng-template #loading>
  <mat-progress-bar mode="indeterminate"
                    color="accent"></mat-progress-bar>
</ng-template>
<ng-container *ngIf="app.diffs$ | async as diffs else loading">
  <section *ngIf="diffs?.length > 0"
           fxLayout="row | wrap"
           fxLayoutAlign="start start"
           class="p8">
    <section *ngFor="let diff of diffs"
             fxLayout="column"
             fxLayoutAlign="start stretch"
             class="rounded elevated card-outline-accent m4"
             [style.width.px]="500">
      <section fxLayout="row"
               fxLayoutAlign="space-between center">
        <span fxFlex
              class="mat-title bold m4">Diff</span>
        <button mat-icon-button
                color="primary"
                (click)="buildGraph(diff)">
          <mat-icon>code</mat-icon>
        </button>
      </section>
      <ng-container *ngFor="let node of app.buildGraph(diff.previous, diff.proposed)">
        <section *ngIf="node.isObject">
          <p class="mat-subheading-2 m4">{{node.key}}</p>
          <section *ngFor="let child of node.values">
            <p class="mat-body-strong m4">{{child.key}}</p>
            <section fxLayout="row | wrap"
                     fxLayoutAlign="start center">
              <p class="p4"
                 [ngClass]="child.same ? 'color.text' : 'background-red'"
                 fxFlex>{{child.previous}}</p>
              <p *ngIf="!(child.same)"
                 class="p4 background-green"
                 fxFlex>{{child.proposed}}</p>
            </section>
          </section>
        </section>
        <section *ngIf="!(node.isObject)">
          <p class="mat-body-strong m4">{{node.key}}</p>
          <section fxLayout="row | wrap"
                   fxLayoutAlign="start center">
            <p class="p4"
               [ngClass]="node.same ? 'background-default' : 'background-red'"
               fxFlex>{{node.previous}}</p>
            <p *ngIf="!(node.same)"
               class="p4 background-green"
               fxFlex>{{node.proposed}}</p>
          </section>
        </section>
      </ng-container>
    </section>
  </section>
  <section *ngIf="!(diffs?.length > 0)"
           class="mat-subheading-2 m4">No Diffs Available</section>
</ng-container>