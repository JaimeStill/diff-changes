<ng-template #loading>
  <mat-progress-bar mode="indeterminate"
                    color="accent"></mat-progress-bar>
</ng-template>
<ng-container *ngIf="app.diffs$ | async as diffs else loading">
  <section *ngIf="diffs?.length > 0"
           fxLayout="row | wrap"
           fxLayoutAlign="start start"
           class="p8">
    <section *ngFor="let diff of diffs"
             fxLayout="column"
             fxLayoutAlign="start stretch"
             class="rounded elevated card-outline-accent m4"
             [style.width.px]="380">
      <section fxLayout="row"
               fxLayoutAlign="space-between center">
        <span fxFlex
              class="mat-title bold m4">Diff</span>
        <button mat-icon-button
                color="primary"
                (click)="buildGraph(diff)">
          <mat-icon>code</mat-icon>
        </button>
      </section>
      <ng-container *ngFor="let node of app.buildGraph(diff.previous, diff.proposed)">
        <section *ngIf="node.isObject">
          <p class="mat-subheading-2 m4"
             [ngClass]="node.same ? 'color-text' : 'color-primary'">{{node.key}}</p>
          <section *ngFor="let child of node.values">
            <p class="mat-body-strong m4">{{child.key}}</p>
            <p class="m4"
               [ngClass]="child.same ? 'color.text' : 'color-red'">{{child.previous}}</p>
            <p *ngIf="!(child.same)"
               class="m4 color-green">{{child.proposed}}</p>
          </section>
        </section>
        <section *ngIf="!(node.isObject)">
          <p class="mat-body-strong m4">{{node.key}}</p>
          <p class="m4"
             [ngClass]="node.same ? 'color-text' : 'color-red'">{{node.previous}}</p>
          <p *ngIf="!(node.same)"
             class="m4 color-green">{{node.proposed}}</p>
        </section>
      </ng-container>
    </section>
  </section>
  <section *ngIf="!(diffs?.length > 0)"
           class="mat-subheading-2 m4">No Diffs Available</section>
</ng-container>